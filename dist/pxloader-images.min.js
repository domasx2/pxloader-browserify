/*! PxLoader v1.0.2 | https://github.com/vdaguenet/pxloader-browserify */
function PxLoaderTags(a){if(this.all=[],this.first=null,this.length=0,this.lookup={},a){if(Array.isArray(a))this.all=a.slice(0);else if("object"==typeof a)for(var b in a)a.hasOwnProperty(b)&&this.all.push(b);else this.all.push(a);this.length=this.all.length,this.length>0&&(this.first=this.all[0]);for(var c=0;c<this.length;c++)this.lookup[this.all[c]]=!0}}function PxLoader(a){a=a||{},this.settings=a,a.concurrency||(a.concurrency=10),null==a.statusInterval&&(a.statusInterval=200),null==a.loggingDelay&&(a.loggingDelay=2e4),null==a.noProgressTimeout&&(a.noProgressTimeout=1/0);var b,c=[],d=[],e=Date.now(),f={QUEUED:0,WAITING:1,LOADED:2,ERROR:3,TIMEOUT:4},g=function(a){return null==a?[]:Array.isArray(a)?a:[a]};this.add=function(a){a.tags=new PxLoaderTags(a.tags),null==a.priority&&(a.priority=1/0),c.push({resource:a,status:f.QUEUED})},this.addProgressListener=function(a,b){d.push({callback:a,tags:new PxLoaderTags(b)})},this.addCompletionListener=function(a,b){d.push({tags:new PxLoaderTags(b),callback:function(b){b.completedCount===b.totalCount&&a(b)}})};var h=function(a){a=g(a);var b=function(b){for(var c=b.resource,d=1/0,e=0;e<c.tags.length;e++)for(var f=0;f<Math.min(a.length,d)&&!(c.tags.all[e]===a[f]&&f<d&&0===(d=f))&&0!==d;f++);return d};return function(a,c){var d=b(a),e=b(c);return d<e?-1:d>e?1:a.priority<c.priority?-1:a.priority>c.priority?1:0}},i=function(){if(c.filter(function(a){return a.status===f.WAITING}).length<a.concurrency)for(var b=c.filter(function(a){return a.status===f.QUEUED}),d=0,e=Math.min(b.length,a.concurrency);d<e;d++){var g=b[d];g.status=f.WAITING,g.resource.start(this)}}.bind(this);this.start=function(a){b=Date.now();var d=h(a);c.sort(d),i(),setTimeout(j,100)};var j=function(){for(var b=!1,d=Date.now()-e,g=d>=a.noProgressTimeout,h=d>=a.loggingDelay,k=0,l=c.length;k<l;k++){var n=c[k];n.status===f.QUEUED&&(b=!0),n.status===f.WAITING&&(n.resource.checkStatus&&n.resource.checkStatus(),n.status===f.WAITING&&(g?n.resource.onTimeout():b=!0))}i(),h&&b&&m(),b&&setTimeout(j,a.statusInterval)};this.isBusy=function(){for(var a=0,b=c.length;a<b;a++)if(c[a].status===f.QUEUED||c[a].status===f.WAITING)return!0;return!1};var k=function(a,b){var g,h,i,j=null;for(g=0,h=c.length;g<h;g++)if(c[g].resource===a){j=c[g];break}if(null!=j&&j.status===f.WAITING)for(j.status=b,e=Date.now(),a.tags.length,g=0,h=d.length;g<h;g++)i=d[g],(0===i.tags.length||a.tags.intersects(i.tags))&&l(j,i)};this.onLoad=function(a){k(a,f.LOADED)},this.onError=function(a){k(a,f.ERROR)},this.onTimeout=function(a){k(a,f.TIMEOUT)};var l=function(a,b){var d,e,g,h=0,i=0;for(d=0,e=c.length;d<e;d++)g=c[d],!1,(0===b.tags.length||g.resource.tags.intersects(b.tags))&&(i++,g.status!==f.LOADED&&g.status!==f.ERROR&&g.status!==f.TIMEOUT||h++);b.callback({resource:a.resource,loaded:a.status===f.LOADED,error:a.status===f.ERROR,timeout:a.status===f.TIMEOUT,completedCount:h,totalCount:i})},m=this.log=function(a){if(window.console){var d=Math.round((Date.now()-b)/1e3);window.console.log("PxLoader elapsed: "+d+" sec");for(var e=0,g=c.length;e<g;e++){var h=c[e];if(a||h.status===f.WAITING){var i="PxLoader: #"+e+" "+h.resource.getName();switch(h.status){case f.QUEUED:i+=" (Not Started)";break;case f.WAITING:i+=" (Waiting)";break;case f.LOADED:i+=" (Loaded)";break;case f.ERROR:i+=" (Error)";break;case f.TIMEOUT:i+=" (Timeout)"}h.resource.tags.length>0&&(i+=" Tags: ["+h.resource.tags.all.join(",")+"]"),window.console.log(i)}}}}}function PxLoaderImage(a,b,c,d){var e=this,f=null;this.img=new Image,void 0!==d&&(this.img.crossOrigin=d),this.tags=b,this.priority=c;var g=function(){"complete"===e.img.readyState&&(j(),f.onLoad(e))},h=function(){j(),f.onLoad(e)},i=function(){j(),f.onError(e)},j=function(){e.unbind("load",h),e.unbind("readystatechange",g),e.unbind("error",i)};this.start=function(b){f=b,e.bind("load",h),e.bind("readystatechange",g),e.bind("error",i),e.img.src=a},this.checkStatus=function(){e.img.complete&&(j(),f.onLoad(e))},this.onTimeout=function(){j(),e.img.complete?f.onLoad(e):f.onTimeout(e)},this.getName=function(){return a},this.bind=function(a,b){e.img.addEventListener?e.img.addEventListener(a,b,!1):e.img.attachEvent&&e.img.attachEvent("on"+a,b)},this.unbind=function(a,b){e.img.removeEventListener?e.img.removeEventListener(a,b,!1):e.img.detachEvent&&e.img.detachEvent("on"+a,b)}}PxLoaderTags.prototype.intersects=function(a){if(0===this.length||0===a.length)return!1;if(1===this.length&&1===a.length)return this.first===a.first;if(a.length<this.length)return a.intersects(this);for(var b in this.lookup)if(a.lookup[b])return!0;return!1},"function"==typeof define&&define.amd&&define("PxLoader",[],function(){return PxLoader}),"object"==typeof module&&(module.exports=PxLoader),Date.now||(Date.now=function(){return(new Date).getTime()}),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),PxLoader.prototype.addImage=function(a,b,c,d){var e=new PxLoaderImage(a,b,c,d);return this.add(e),e.img},"function"==typeof define&&define.amd&&define("PxLoaderImage",[],function(){return PxLoaderImage});